server {
    listen 80;
    server_name localhost;

    # Imposta la directory root sulla cartella 'public' di Symfony
    root /var/www/html/public;

    # Prova a servire il file statico, altrimenti inoltra a index.php
    location / {
        try_files $uri /index.php$is_args$args;
    }

    # Blocco per l'inoltro delle richieste PHP al container PHP-FPM
    location ~ ^/index\.php(/|$) {
        # 'php' Ã¨ il nome del servizio nel docker-compose.yml
        fastcgi_pass php:9000;

        fastcgi_split_path_info ^(.+\.php)(/.*)$;
        include fastcgi_params;

        # Variabili necessarie per Symfony
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        fastcgi_param DOCUMENT_ROOT $document_root;
        internal;
    }

    # Impedisci l'accesso diretto ai file dot (es. .env, .git)
    location ~ /\. {
        deny all;
    }

    # Gestione ottimale degli asset
    location ~ \.(ico|css|js|gif|jpe?g|png)\$ {
        expires max;
        log_not_found off;
        # Aggiungi il percorso /build/ per gli asset Vite/Encore
        try_files \$uri \$uri/ /build/\$uri;
    }
}
